import Sortable from"sortablejs/modular/sortable.complete.esm.js";import{log}from"util";const formElements=document.getElementById("form-elements"),formCreator=document.getElementById("form-creator"),addRowButton=document.getElementById("add-row"),formElementsSortable=Sortable.create(formElements,{group:{name:"shared",pull:"clone"},animation:150,onAdd:function(evt){evt.from!==formElements&&evt.item.parentNode.removeChild(evt.item)}}),addRowButtonCols1=document.getElementById("add-row-cols-1"),addRowButtonCols2=document.getElementById("add-row-cols-2");function addRow(columns){const newRow=document.createElement("div");newRow.classList.add("js-row","grid","border","gap-2","min-h-[40px]","relative","my-2"),newRow.classList.add(1===columns?"grid-cols-1":"grid-cols-2"),formCreator.querySelector(".flex").appendChild(newRow);const deleteButton=document.createElement("button");deleteButton.classList.add("absolute","top-0","right-0","bg-red-500","text-white","px-2","py-1","rounded"),deleteButton.textContent="X",newRow.appendChild(deleteButton),deleteButton.addEventListener("click",()=>{newRow.remove()}),Sortable.create(newRow,{group:{name:"shared"},animation:150,onAdd:function(evt){if(evt.to===formElements)evt.item.parentNode.removeChild(evt.item);else{const inputElements=evt.item.querySelectorAll("input, textarea, publicity,div");inputElements.forEach(input=>{input.removeAttribute("readonly")});const editableElements=evt.item.querySelectorAll(".js-editable-element");editableElements.forEach(element=>{element.setAttribute("contenteditable","true")})}const setNameElement=evt.item.querySelector(".set-name");setNameElement&&setNameElement.classList.remove("hidden");const setPublicityElement=evt.item.querySelector(".set-publicity");setPublicityElement&&setPublicityElement.classList.remove("hidden");const itemCount=newRow.getElementsByClassName("js-element").length;evt.item.querySelector("input[type='text']")&&"text"===evt.item.querySelector("input[type='text']").id?(evt.item.querySelector("input[type='text']").name=`text-field-${inputCounter}`,evt.item.querySelector("input[type='text']").placeholder=`text-field-${inputCounter}`,evt.item.querySelector(".set-name").value=`text-field-${inputCounter}`,inputCounter++):evt.item.querySelector("textarea")&&(evt.item.querySelector("textarea").name=`text-area-${textareaCounter}`,evt.item.querySelector("textarea").placeholder=`text-area-${textareaCounter}`,evt.item.querySelector(".set-name").value=`text-area-${textareaCounter}`,textareaCounter++)}})}addRowButtonCols1.addEventListener("click",()=>addRow(1)),addRowButtonCols2.addEventListener("click",()=>addRow(2)),addRowButtonCols1.click();let inputCounter=1,textareaCounter=1;function cleanFormContent(content){const parsedHtml=$("<div>").html(content);return parsedHtml.find(".set-name, [contenteditable], [draggable], [style], .bg-red-500, .js-remlunch").each((function(){$(this).is("[contenteditable]")&&$(this).removeAttr("contenteditable"),$(this).is("[draggable]")&&$(this).removeAttr("draggable"),$(this).is("[style]")&&$(this).removeAttr("style"),$(this).hasClass("bg-red-500")&&$(this).remove(),$(this).hasClass("set-name")&&$(this).remove(),$(this).hasClass("js-remlunch")&&$(this).remove(),$(this).hasClass("my-2")&&$(this).removeClass("my-2")})),parsedHtml.find(".border").each((function(){$(this).removeClass("border")})),parsedHtml.html()}document.addEventListener("input",event=>{if(event.target.matches(".set-name")){const element=event.target.previousElementSibling,newName=event.target.value;""!==newName.trim()&&(element.name=newName.trim(),element.placeholder=newName.trim())}});let publicity_active=!1;$(".js-publicity-check").on("change",(function(){$(this).is(":checked")?$("html").find("publicity").each((function(){$(this).addClass("force_hidden")})):publicity_active=!1,console.log(publicity_active)}));let valid_flag=[!0];$("#submit-form").on("click",(function(){const formCreatorContent=formCreator.innerHTML;let cleanFormCreatorContent=cleanFormContent(formCreatorContent);$.ajax({url:route("document.store"),type:"POST",data:{name:$('[name="name"]').val(),description:$('[name="description"]').val(),content:cleanFormCreatorContent,_token:document.querySelector('meta[name="csrf-token"]').getAttribute("content")},success:function(response){console.log(response),window.location.href=route("dashboard.index")}})})),$(),$("html").on("click mousemove click keyup keydown keypress",(function(){0==$(".js-form-creator").find("p, h3, input, textarea").length?valid_flag[0]=!1:valid_flag[0]=!0;var emptyExists=!1,allTrue;$(".js-form-creator .set-publicity").each((function(){if(0==$(this).find('input[type="checkbox"]:checked').length)return emptyExists=!0,!1})),valid_flag[1]=!emptyExists,$(".set-name").each((function(){var setNameValue;""==$(this).val().trim()?valid_flag[2]=!1:valid_flag[2]=!0})),valid_flag.every((function(element){return!0===element}))?$("#submit-form").removeClass("bg-opacity-40").prop("disabled",!1):$("#submit-form").addClass("bg-opacity-40").prop("disabled",!0)}));